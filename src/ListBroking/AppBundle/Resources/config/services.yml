imports:
    - { resource: admin_services.yml }

services:
  listbroking.flush_listener:
    class: ListBroking\AppBundle\EventListener\FlushListener
    arguments: [@doctrine_cache.providers.memcached_query_cache]
    tags:
        - { name: doctrine.event_listener, event: onFlush }

  listbroking.appbundle.filters.form:
    class:  ListBroking\AppBundle\Form\FiltersForm
    arguments: [@app, @lead]
    tags:
      - { name: form.type, alias: filters }

  listbroking.appbundle.json.form.type:
    class: ListBroking\AppBundle\Form\Type\JsonType
    tags:
      - { name: form.type, alias: json }

  base:
    class: ListBroking\AppBundle\Service\BaseService\BaseService
    abstract: true
    calls:
      - [setLogger, [@logger]]
      - [setDoctrine, [@doctrine]]
      - [setEntityManager, [@doctrine.orm.entity_manager]]
      - [setCache, [@doctrine_cache.providers.memcached_query_cache]]
      - [setFormFactory, [@form.factory]]

  filter_engine:
    class: ListBroking\AppBundle\Engine\FilterEngine
    arguments:
      entityManager: @doctrine.orm.entity_manager

  app:
    class: ListBroking\AppBundle\Service\AppService
    parent: base

  lead:
    class: ListBroking\AppBundle\Service\LeadService
    arguments:
      entityManager: @doctrine.orm.entity_manager

  extraction:
    class: ListBroking\AppBundle\Service\ExtractionService
    parent: base
    arguments: [@request_stack, @filter_engine, @mailer, @twig ]

  ui:
    class: ListBroking\AppBundle\Service\UIService
    parent: base